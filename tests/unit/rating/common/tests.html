<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8" />
	<title>Infragistics jQuery Client Rating - common example </title>
	<link id="Link1" type="text/css" href="../../../../src/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />	
	<link type="text/css" href="../../../../src/css/structure/modules/infragistics.ui.rating.css" rel="stylesheet" />
	<script type="text/javascript" src="../../../../bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="../../../../bower_components/jquery-ui/jquery-ui.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.util.jquery.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.widget.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/infragistics.ui.rating.js"></script>
	<script type="text/javascript" src="../../../../src/js/modules/i18n/infragistics.ui.rating-en.js"></script>
	<script type="text/javascript" src="../../common/test-util.js"></script>

	<link type="text/css" href="../../../../bower_components/qunit/qunit/qunit.css" rel="stylesheet" media="screen" />
	<script type="text/javascript" src="../../../../bower_components/qunit/qunit/qunit.js"></script>
	
	<script type="text/javascript">
	/*global window, setTimeout, $, startTesting, QUnit, module, test, ok, equals*/
	$(function() {
		// Create ratings
		$('#rating1').igRating();
		$('#rating2').igRating({
			vertical: true,
			precision: 'exact',
			value: 0.8
		});
		$('#rating3').igRating({
			voteCount: 6,
			value: 0.8,
			precision: 'half'
		});
		$('#rating4').igRating({
			vertical: true,
			voteCount: 6,
			value: 0.8,
			precision: 'half'
		});
		$('#rating5').igRating({
			voteCount: 4,
			swapDirection: true,
			value: 0.8,
			precision: 'whole'
		});
		$('#rating6').igRating({
			vertical: true,
			voteCount: 4,
			swapDirection: true,
			value: 0.8,
			precision: 'whole'
		});
	});
	// START TESTING
	module('igRating Common');
	var testId = '[ID1] rating common';
	test(testId,
		function() {
			var i, elem, good, main, val0, val, rating = $('#rating1');
			val = rating.igRating('value');
			val0 = 0;
			equal(val, val0, 'Value of rating1');
			//QUnit.log(val === val0, testId + ' value in rating1 was correct');
			//
			rating = $('#rating2');
			val = rating.igRating('value');
			val0 = 0.8;
			equal(val, val0, 'Value of rating2');
			//QUnit.log(val === val0, testId + ' value in rating2 was correct');
			//
			rating = $('#rating3');
			val = rating.igRating('value');
			good = Math.abs(val - 0.8) < 0.002;
			ok(good, 'Value of rating3 is correct');
			//QUnit.log(good, testId + ' value in rating3 was correct');
			//
			rating = $('#rating4');
			val = rating.igRating('value');
			good = Math.abs(val - 0.8) < 0.002;
			ok(good, 'Value of rating4 is correct');
			//QUnit.log(good, testId + ' value in rating4 was correct');
			//
			rating = $('#rating5');
			val = rating.igRating('value');
			val0 = 0;
			good = Math.abs(val - 0.8) < 0.002;
			ok(good, 'Value of rating5 is correct');
			//QUnit.log(good, testId + ' value in rating5 was correct');
			//
			rating = $('#rating6');
			val = rating.igRating('value');
			good = Math.abs(val - 0.8) < 0.002;
			ok(good, 'Value of rating6 is correct');
			//QUnit.log(good, testId + ' value in rating6 was correct');
			//
			for (i = 1; i < 3; i++) {
				main = $('#rating' + i).data('igRating').element;
				elem = main.find('.ui-igrating-vote');
				good = elem && elem.length === 15;
				ok(good, 'Vote elements in rating' + i + ' is 15');
				//QUnit.log(good, testId + ' vote elements in rating' + i + ' is 15');
				elem = main.find('.ui-igrating-voteselected');
				good = elem && elem.length === 5;
				ok(good, 'Selected votes in rating' + i + ' is 5');
				//QUnit.log(good, testId + ' selected votes in rating' + i + ' is 5');
				elem = main.find('.ui-igrating-votehover');
				good = elem && elem.length === 5;
				ok(good, 'Hover votes in rating' + i + ' is 5');
				//QUnit.log(good, testId + ' hover votes in rating' + i + ' is 5');
				//
				main = $('#rating' + (i + 2)).data('igRating').element;
				elem = main.find('.ui-igrating-vote');
				good = elem && elem.length === 18;
				ok(good, 'Vote elements in rating' + (i + 2) + ' is 18');
				//QUnit.log(good, testId + ' vote elements in rating' + (i + 2) + ' is 18');
				elem = main.find('.ui-igrating-voteselected');
				good = elem && elem.length === 6;
				ok(good, 'Selected votes in rating' + (i + 2) + ' is 6');
				//QUnit.log(good, testId + ' selected votes in rating' + (i + 2) + ' is 6');
				elem = main.find('.ui-igrating-votehover');
				good = elem && elem.length === 6;
				ok(good, 'Hover votes in rating' + (i + 2) + ' is 6');
				//QUnit.log(good, testId + ' hover votes in rating' + (i + 2) + ' is 6');
				//
				main = $('#rating' + (i + 4)).data('igRating').element;
				elem = main.find('.ui-igrating-vote');
				good = elem && elem.length === 12;
				ok(good, 'Vote elements in rating' + (i + 4) + ' is 12');
				//QUnit.log(good, testId + ' vote elements in rating' + (i + 4) + ' is 12');
				elem = main.find('.ui-igrating-voteselected');
				good = elem && elem.length === 4;
				ok(good, 'Selected votes in rating' + (i + 4) + ' is 4');
				//QUnit.log(good, testId + ' selected votes in rating' + (i + 4) + ' is 4');
				elem = main.find('.ui-igrating-votehover');
				good = elem && elem.length === 4;
				ok(good, 'Hover votes in rating' + (i + 4) + ' is 4');
				//QUnit.log(good, testId + ' hover votes in rating' + (i + 4) + ' is 4');
			}
			val = rating.find('*').length;
			good = val > 10;
			ok(good, 'rating has child elements');
			//QUnit.log(good, testId + ' rating has child elements');
			rating.igRating('destroy');
			val = rating.find('*').length;
			good = val === 0;
			ok(good, 'destroyed rating has no child elements');
			//QUnit.log(good, testId + ' destroyed rating has no child elements');
		});

	module('igRating Common');
	testId = '[ID2] rating common';
	test(testId,
		function() {
			var val, rating = $('#rating2');
			val = rating.igRating('value');
			equal(val, 0.8, 'rating value');
			//QUnit.log(val === 0.8, testId + ' rating value');
			//
			val = rating.igRating('valueHover');
			equal(val, 0.8, 'rating valueHover');
			//QUnit.log(val === 0.8, testId + ' rating valueHover');
			//
			rating.igRating('valueHover', 0.5);
			val = rating.igRating('valueHover');
			equal(val, 0.5, 'rating valueHover set to 0.5');
			//QUnit.log(val === 0.5, testId + ' rating valueHover set to 0.5');
			//
			rating.igRating('value', 0.3);
			val = rating.igRating('value');
			equal(val, 0.3, 'rating value set to 0.3');
			//QUnit.log(val === 0.3, testId + ' rating value set to 0.3');
			//
			val = rating.igRating('option', 'precision');
			equal(val, 'exact', 'rating precision is correct');
			//QUnit.log(val === 'exact', testId + ' rating precision is correct');
			//
			rating.igRating('option', 'precision', 'whole');
			val = rating.igRating('option', 'precision');
			equal(val, 'whole', 'rating precision was changed');
			//QUnit.log(val === 'whole', testId + ' rating precision was changed');
			//
			val = rating.igRating('value');
			equal(val, 0.3, 'rating get value is correct');
			//QUnit.log(val === 0.3, testId + ' rating get value is correct');
			//
			val = rating.igRating('valueHover');
			equal(val, 0.5, 'rating whole precision valueHover');
			//QUnit.log(val === 0.5, testId + ' rating whole precision valueHover');
			//
			rating.igRating('valueHover', 0.3);
			val = rating.igRating('valueHover');
			equal(val, 0.3, 'rating whole precision valueHover set to 0.3');
			//QUnit.log(val === 0.3, testId + ' rating whole precision valueHover set to 0.3');
			//
		});

	module('igRating Common');
	testId = '[ID3] rating constructor over div tag';
	test(testId,
		function(assert) {
			var rating = $('#rating7')
				.css('direction', 'rtl')
				.igRating({
					theme: 'redmond',
					valueAsPercent: false,
					value: 0.5,
					valueHover: 0.55
				}),
				done = assert.async();

			expect(9);

			var theme = rating.igRating("option", "theme");
			equal(theme, "redmond", "rating theme");

			var direction = rating.css("direction");
			equal(direction, "ltr", "rating css direction swapped");
			var swapDirection = rating.igRating("option", "swapDirection");
			notOk(swapDirection, "rating swapDirection")

			var val = rating.igRating("value");
			equal(val, 0.5, "rating get value of the div");

			val = rating.igRating("valueHover");
			equal(val, 0.55, "rating get valueHover");

			val = rating.igRating('hasFocus');
			ok(!val, 'rating has no focus');

			rating.igRating('focus');

			$.ig.TestUtil.wait(300).then(function () {
				val = rating.igRating('hasFocus');
				ok(val, 'rating has focus');

				// get the internal input element of the rating control
				var activeElem = rating.find(".ui-igrating-active");
				ok(activeElem && activeElem.length > 0, "rating has active element");

				var inputEl = activeElem[0].children[0].children[0];
				$(inputEl).blur();

				return $.ig.TestUtil.wait(400);
			}).then(function () {
				var activeElem1 = rating.find(".ui-igrating-active");
				ok(activeElem1 && activeElem1.length === 0, "rating doesn't have active element after blur");

				rating.remove();

				done();
			}).catch(function (er) {
				assert.pushResult({ result: false, message: er.message });
				done();
				throw er;
			});
		});

	module('igRating Common');
	testId = '[ID4] rating constructor over input tag';
	test(testId,
		function(assert) {
			var rating = $('#rating8')
				.igRating({
					inputName: 'rating8',
					value: 0.5
				});

			expect(2);

			var val = rating.igRating("value");
			equal(val, 0.3, "rating get value of the input");

			var id = rating.igRating("option", "inputName");
			equal(id, "rating8", "rating inputName");

			rating.remove();
		});

	module('igRating Common');
	testId = '[ID5] rating constructor over non existing input tag';
	test(testId,
		function(assert) {
			var rating = $('#rating9')
				.igRating({
					inputName: 'rating_non_existing',
					value: 0.5
				});

			expect(1);

			var val = rating.igRating("value");
			equal(val, 0.5, "rating get value of the widget");

			rating.remove();
		});

	module('igRating Common');
	testId = '[ID6] rating keydown events';
	test(testId,
		function(assert) {
			var rating10 = $('#rating10').igRating({ valueHover: 0.2 });
			var rating11 = $('#rating11').igRating({ valueHover: 0.6, vertical: true });
			var kc = $.ui.keyCode;

			expect(10);

			// get the internal input element of the rating control
			var inputEl10 = rating10[0].children[0].children[0].children[0];
			var inputEl11 = rating11[0].children[0].children[0].children[0];

			// space key down
			var keyPressSpaceEvt = $.Event('keydown', {which: kc.SPACE, keyCode: kc.SPACE});
			$(inputEl10).trigger(keyPressSpaceEvt);
			var val = rating10.igRating('value');
			equal(val, 0.2, "value should be set to valueHover if Space key is pressed");

			// enter key down
			var keyPressEnterEvt = $.Event('keydown', {which: kc.ENTER, keyCode: kc.ENTER});
			$(inputEl11).trigger(keyPressEnterEvt);
			val = rating11.igRating('value');
			equal(val, 0.6, "value should be set to valueHover if Enter key is pressed");

			// reset the ratings' values for the following tests
			rating10.igRating('value', 0.3);
			rating11.igRating('value', 0.5);

			// home key down
			var keyPressHomeEvt = $.Event('keydown', {which: kc.HOME, keyCode: kc.HOME});
			$(inputEl10).trigger(keyPressHomeEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after Home key is pressed");

			// end key down
			var keyPressEndEvt = $.Event('keydown', {which: kc.END, keyCode: kc.END});
			$(inputEl10).trigger(keyPressEndEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after End key is pressed");

			// Page Up key down
			var keyPressPageUpEvt = $.Event('keydown', {which: kc.PAGE_UP, keyCode: kc.PAGE_UP});
			$(inputEl10).trigger(keyPressPageUpEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after Page Up key is pressed");

			// Page Down key down
			var keyPressPageDownEvt = $.Event('keydown', {which: kc.PAGE_DOWN, keyCode: kc.PAGE_DOWN});
			$(inputEl10).trigger(keyPressPageDownEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after Page Down key is pressed");

			// Left key down
			var keyPressLeftEvt = $.Event('keydown', {which: kc.LEFT, keyCode: kc.LEFT});
			$(inputEl10).trigger(keyPressLeftEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after Left key is pressed");

			// Right key down
			var keyPressRightEvt = $.Event('keydown', {which: kc.RIGHT, keyCode: kc.RIGHT});
			$(inputEl10).trigger(keyPressRightEvt);
			val = rating10.igRating('value');
			equal(val, 0.3, "value should be unchanged after Right key is pressed");

			// Up key down
			var keyPressUpEvt = $.Event('keydown', {which: kc.UP, keyCode: kc.UP});
			$(inputEl11).trigger(keyPressUpEvt);
			val = rating11.igRating('value');
			equal(val, 0.5, "value should be unchanged after Up key is pressed");

			// Down key down
			var keyPressDownEvt = $.Event('keydown', {which: kc.DOWN, keyCode: kc.DOWN});
			$(inputEl11).trigger(keyPressDownEvt);
			val = rating11.igRating('value');
			equal(val, 0.5, "value should be unchanged after Down key is pressed");

			rating10.remove();
			rating11.remove();
		});

	module('igRating Common');
	testId = '[ID7] rating options';
	test(testId,
		function(assert) {
			expect(8);

			var rating = $('#rating12').igRating({ value: 0.3, focusable: true, theme: 'redmond' });
			rating.igRating('option', 'value', 0.3);
			var val = rating.igRating('value');
			equal(val, 0.3, "Value should not be changed when trying to set the same value again");

			throws(function() {
				rating.igRating('option', 'focusable', false);
			}, "Trying to set a readonly option should result in exception");

			rating.igRating('option', 'disabled', true);
			var spans = $("SPAN", rating);
			ok(spans.hasClass("ui-state-disabled"), "The ui-state-disabled class should be applied to all child spans");

			rating.igRating('option', 'disabled', false);
			notOk(spans.hasClass("ui-state-disabled"), "The ui-state-disabled class shouldn't be applied to all child spans");

			rating.igRating('option', 'theme', 'gold');
			var theme = rating.igRating('option', 'theme');
			equal(theme, 'gold', 'Set the theme option')

			rating.igRating('option', 'dummyOption', function(){});
			var dummyOption = rating.igRating('option', 'dummyOption');
			ok(dummyOption && typeof(dummyOption) === 'function', 'dummyOption option should be defined as function');

			rating.igRating('option', 'value', 0.5);
			val = rating.igRating('value');
			equal(val, 0.5, "Value should be changed");

			rating.igRating("option", "validatorOptions", {onblur: true});
			var validatorOptions = rating.igRating("option", "validatorOptions");
			ok(validatorOptions.onblur, 'validatorOptions should be applied correctly');

			rating.remove();
		});

	module('igRating Common');
	testId = '[ID8] rating mouse events';
	test(testId,
		function(assert) {
			expect(3);

			var rating = $('#rating13').igRating();
			var eventFired = false;
			var spans = rating.find('.ui-igrating-vote');
			var done = assert.async();

			var span3 = $(spans[2]);
			span3.on('mousedown', function () {
				eventFired = true;
			});
			span3.on('mousemove', function () {
				eventFired = true;
			});
			span3.on('mouseleave', function () {
				eventFired = true;
			});

			// mousemove over the third span
			span3.trigger('mousemove');
			$.ig.TestUtil.wait(300).then(function () {
				ok(eventFired, 'mousemove event fired');
				flag = false;

				// mousedown on the third span
				span3.trigger('mousedown');

				return $.ig.TestUtil.wait(300);
			}).then(function () {
				var val = rating.igRating('value');
				ok(eventFired && val >= 0.4 && val <= 0.6, 'mousedown event fired');
				flag = false;

				// mouseleave on the third span
				span3.trigger('mouseleave');

				return $.ig.TestUtil.wait(300);
			}).then(function () {
				ok(eventFired, 'mouseleave event fired');

				rating.remove();
				done();
			}).catch(function (er) {
				assert.pushResult({ result: false, message: er.message });
				done();
				throw er;
			});
		});
</script>

</head>

<body>
<div style="float: right; width: 400px; overflow: auto">
	<h1 id="qunit-header">Test results</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
</div>
<div style="float: left; overflow: auto; padding: 20px;">
	<div id="rating1"></div>
	<div id="rating2"></div>
	<div id="rating3"></div>
	<div id="rating4"></div>
	<div id="rating5"></div>
	<div id="rating6"></div>
	<div id="rating7"></div>
	<input id="rating8" value="0.3"></input>
	<input id="rating9" value="0.3"></input>
	<div id="rating10"></div>
	<div id="rating11"></div>
	<div id="rating12"></div>
	<div id="rating13"></div>
</div>
</body>

</html>